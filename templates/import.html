<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Import</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-5">
    <h1>Data Import</h1>

    <button class="btn btn-primary" id="importButton">Import Data</button>

    <div class="progress mt-3" style="display: none;" id="progressBarContainer">
        <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="progressBar"></div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function() {
        // Function to update progress bar based on SSE events
        function updateProgressBar(event) {
            const data = JSON.parse(event.data);
            const progress = data.progress;

            // Update the progress bar based on the data received
            $('#progressBar').css('width', progress + '%').attr('aria-valuenow', progress);
            
            // Check if the import is complete (progress = 100)
            if (progress === 100) {
                // Re-enable the button after the import is complete
                $('#importButton').attr('disabled', false);
            }
        }

        // EventSource for handling Server-Sent Events
        const eventSource = new EventSource('/import');

        // Handle messages received from the server
        eventSource.onmessage = updateProgressBar;

        // Handle errors
        eventSource.onerror = function(error) {
            console.error('Error during import:', error);
            eventSource.close();
        };

        // Click event for the import button
        $('#importButton').on('click', function() {
            // Show the progress bar container
            $('#progressBarContainer').show();

            // Disable the button during the import process
            $('#importButton').attr('disabled', true);
        });

        // Close the EventSource connection when the window is closed or navigated away
        window.onbeforeunload = function() {
            eventSource.close();
        };
    });
</script>

</body>
</html>